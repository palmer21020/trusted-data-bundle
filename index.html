<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trusted Data Bundle</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* Your CSS (same as before) */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{background:#f0f2f5;color:#333;}
header{display:flex;justify-content:space-between;align-items:center;padding:12px 20px;background:#0d47a1;color:white;position:sticky;top:0;z-index:100;border-radius:0 0 12px 12px;flex-direction:column;gap:6px;}
header h1{font-size:1.4rem;display:flex;align-items:center;gap:6px;}
.logo-text{font-weight:700;font-size:1rem;background:white;color:#0d47a1;padding:4px 8px;border-radius:6px;}
#infoBar{display:flex;gap:12px;justify-content:center;font-weight:600;font-size:0.85rem;background:#4caf50;color:white;padding:6px 10px;border-radius:6px;}
#walletHeader{background:rgba(255,255,255,0.2);padding:5px 10px;border-radius:8px;font-weight:600;}
#menuBtn{font-size:1.5rem;cursor:pointer;}
#sideMenu{position:fixed;left:-250px;top:0;width:250px;height:100%;background:#0b3d91;color:white;padding-top:60px;transition:0.3s;display:flex;flex-direction:column;z-index:101;}
#sideMenu button{background:none;border:none;color:white;padding:15px 20px;text-align:left;font-size:1rem;cursor:pointer;}
#sideMenu button:hover{background:#ffc107;color:#000;}
#overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.3);display:none;z-index:100;}
main{max-width:600px;margin:auto;padding:15px;}
.network-section{margin-bottom:20px;}
.network-title{font-weight:700;font-size:1.2rem;margin-bottom:8px;padding-left:6px;}
.bundle-container{display:flex;gap:12px;overflow-x:auto;padding:12px;scroll-behavior:smooth;}
.bundle-card{min-width:140px;background:white;border-radius:12px;padding:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);display:flex;flex-direction:column;justify-content:space-between;flex-shrink:0;transition:0.3s;}
.bundle-card:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.15);}
.bundle-card h3{margin-bottom:6px;font-weight:600;font-size:1rem;}
.bundle-card p{font-weight:600;margin-bottom:8px;font-size:0.9rem;}
.bundle-card button{border:none;padding:6px 10px;border-radius:6px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:0.85rem;transition:0.3s;width:100%;margin-bottom:4px;}
.buyNow{background:#0d47a1;color:white;}
.buyWallet{background:#ffc107;color:#0d47a1;}
#walletTopUp{margin-bottom:15px;display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-start;}
#walletTopUp input{padding:8px 8px;border-radius:6px;border:1px solid #ccc;width:120px;flex:1;}
#walletTopUp button{background:#0d47a1;color:white;border:none;padding:8px 10px;border-radius:6px;font-weight:600;cursor:pointer;transition:0.3s;flex:1;}
#walletTopUp button:hover{background:#093170;}
footer{background:#0d47a1;color:white;padding:15px;text-align:center;border-radius:12px;margin-top:20px;}
footer a{color:white;text-decoration:none;margin:0 8px;font-weight:600;}
footer p{margin-top:10px;font-size:0.85rem;}
</style>
</head>
<body>
<header>
  <div style="display:flex;align-items:center;gap:8px;">
    <span id="menuBtn">&#9776;</span>
    <h1>
      <img src="https://upload.wikimedia.org/wikipedia/commons/1/19/Flag_of_Ghana.svg" alt="Ghana Flag" style="height:22px;">
      <span class="logo-text">Trusted Data Bundle</span>
    </h1>
  </div>
  <div id="infoBar">
    <span>âœ… Non-expiry</span>
    <span>âš¡ Fast Delivery</span>
    <span>ðŸ’° Best Prices</span>
  </div>
  <div id="walletHeader">Wallet: GHC 0</div>
</header>

<div id="sideMenu">
<button onclick="showTab('store')">Store</button>
<button onclick="showTab('dashboard')">Dashboard</button>
<button onclick="showTab('wallet')">Wallet</button>
<button onclick="showTab('orders')">Orders</button>
<button onclick="showTab('account')">Account</button>
<button onclick="showTab('support')">Support</button>
</div>
<div id="overlay"></div>

<main>
<section id="dashboard" style="display:none;">
<h2>Customer Dashboard</h2>
<div style="display:flex;flex-direction:column;gap:15px;">
<div style="background:#fff;padding:12px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);">
<strong>Wallet Balance:</strong> GHC <span id="dashWallet">0</span>
<canvas id="walletChart" style="width:100%;height:150px;margin-top:10px;"></canvas>
</div>
<div style="background:#fff;padding:12px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);">
<strong>Orders per Network:</strong>
<canvas id="ordersChart" style="width:100%;height:150px;margin-top:10px;"></canvas>
</div>
<div style="background:#fff;padding:12px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);display:flex;gap:8px;flex-wrap:wrap;">
<button onclick="showTab('store')">Store</button>
<button onclick="showTab('wallet')">Wallet Top-Up</button>
<button onclick="showTab('support')">Support</button>
</div>
<div style="background:#fff;padding:12px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);">
<strong>Recent Orders:</strong>
<div id="dashOrders"></div>
</div>
</div>
</section>

<section id="store" style="display:block;">
<div id="allNetworks"></div>
</section>

<section id="wallet" style="display:none;">
<h2>Wallet Top-Up</h2>
<div id="walletTopUp">
<input type="number" id="topUpAmount" placeholder="Amount GHC">
<button onclick="topUp()">Top-Up</button>
</div>
</section>

<section id="orders" style="display:none;">
<h2>Purchased Bundles</h2>
<table border="1" style="width:100%;border-collapse:collapse;">
<thead>
<tr><th>Network</th><th>Bundle</th><th>Price</th><th>Status</th><th>Date</th><th>Phone</th><th>Reference</th></tr>
</thead>
<tbody id="ordersTable"></tbody>
</table>
</section>

<section id="account" style="display:none;">
<h2>Account Details</h2>
<p><strong>Name:</strong> Yussif Dawud</p>
<p><strong>MoMo Number:</strong> 0541896641</p>
</section>

<section id="support" style="display:none;">
<h2>Customer Support</h2>
<p><strong>MoMo:</strong> 0541896641</p>
<p><strong>WhatsApp:</strong> <a href="https://wa.me/233541896641" target="_blank">Chat Now</a></p>
<p><strong>Email:</strong> support@trustedbundles.com</p>
</section>
</main>

<footer>
<p>Connect with us: <a href="#">Facebook</a> | <a href="#">Twitter</a> | <a href="https://wa.me/233541896641">WhatsApp</a></p>
<p>&copy; 2025 Trusted Data Bundle</p>
</footer>

<script>
const BACKEND_URL = "https://trustedbundles.onrender.com"; // Replace with your backend URL

document.getElementById('menuBtn').onclick=()=>{document.getElementById('sideMenu').style.left='0';document.getElementById('overlay').style.display='block';};
document.getElementById('overlay').onclick=()=>{document.getElementById('sideMenu').style.left='-250px';document.getElementById('overlay').style.display='none';};
function showTab(tab){document.querySelectorAll('main section').forEach(s=>s.style.display='none');document.getElementById(tab).style.display='block';document.getElementById('sideMenu').style.left='-250px';document.getElementById('overlay').style.display='none';}

// ===== Bundles =====
const colors={'MTN':'#ffd700','AirtelTigo':'#e53935','Telecel':'#4caf50'};
const bundles={
  'MTN':{'2GB':11,'3GB':15,'4GB':20,'5GB':27,'6GB':32,'7GB':36,'8GB':41,'9GB':43,'10GB':47,'20GB':86,'25GB':106,'30GB':126,'40GB':170,'50GB':210,'Ada':5,'Afa':7},
  'AirtelTigo':{'1GB':5,'2GB':10,'3GB':14,'4GB':19,'5GB':23,'6GB':28,'7GB':32,'8GB':35,'9GB':38,'10GB':44,'15GB':67,'20GB':80,'30GB':119,'40GB':154,'Big Time Data':100},
  'Telecel':{'5GB':30,'10GB':45,'15GB':67,'20GB':84,'30GB':123,'40GB':200,'50GB':210}
};

function renderAllNetworks(){
    const container=document.getElementById('allNetworks'); container.innerHTML='';
    for(const network in bundles){
        const section=document.createElement('div'); section.className='network-section';
        section.innerHTML=`<div class="network-title" style="color:${colors[network]};">${network} Bundles</div>`;
        const cardContainer=document.createElement('div'); cardContainer.className='bundle-container';
        for(const b in bundles[network]){
            const price=bundles[network][b]; const card=document.createElement('div'); card.className='bundle-card';
            card.innerHTML=`<h3>${b}</h3><p>Price: GHC ${price}</p><button class="buyNow" onclick="alert('Buy Now coming soon!')">Buy Now</button><button class="buyWallet" onclick="buyWithWallet('${network}','${b}',${price})">Buy with Wallet</button>`;
            cardContainer.appendChild(card);
        }
        section.appendChild(cardContainer); container.appendChild(section);
    }
}
renderAllNetworks();

// ===== Wallet & Payment =====
async function topUp() {
    const amount = parseFloat(document.getElementById('topUpAmount').value);
    const phone = prompt("Enter your phone number for MoMo payment:");
    if (!phone || isNaN(amount) || amount <= 0) return alert("Valid phone & amount required");

    const externalId = "TXN_" + Math.random().toString(36).substr(2, 9).toUpperCase();

    try {
        const res = await fetch(`${BACKEND_URL}/requestPayment`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ phone, amount, externalId })
        });
        const data = await res.json();
        alert(data.message);
    } catch (err) {
        console.error(err);
        alert("Error sending payment request");
    }
}

async function buyWithWallet(network, bundle, price) {
    const phone = prompt("Enter your phone number to use wallet:");
    if (!phone) return alert("Phone required");

    const res = await fetch(`${BACKEND_URL}/wallet/${phone}`);
    const data = await res.json();
    if (data.balance < price) return alert("Insufficient wallet balance!");

    const order = {
        network, bundle, price, phone, status: "Delivered", date: new Date().toLocaleString()
    };

    await fetch(`${BACKEND_URL}/webhook`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ ...order, amount: -price })
    });

    alert(`Purchased ${bundle} on ${network} using wallet!`);
    renderOrders();
}

async function renderOrders() {
    const res = await fetch(`${BACKEND_URL}/orders`);
    const sales = await res.json();
    const tbody = document.getElementById('ordersTable');
    tbody.innerHTML = '';
    const dashOrders = document.getElementById('dashOrders');
    dashOrders.innerHTML = '';
    sales.slice(-10).forEach(s => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${s.network || '-'}</td><td>${s.bundle || '-'}</td><td>${s.price || s.amount}</td><td>${s.status}</td><td>${s.date}</td><td>${s.phone}</td><td>${s.reference || '-'}</td>`;
        tbody.appendChild(tr);
        dashOrders.innerHTML += `<p>${s.date} - ${s.network || '-'} ${s.bundle || '-'} GHC ${s.price || s.amount}</p>`;
    });
}
renderOrders();
</script>
</body>
</html>